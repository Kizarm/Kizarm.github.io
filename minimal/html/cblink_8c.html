<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>ARM_minimal.: Dokumentace souboru cblink.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ARM_minimal.
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generováno programem Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Hledat');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Hlavní&#160;stránka</span></a></li>
      <li><a href="annotated.html"><span>Třídy</span></a></li>
      <li class="current"><a href="files.html"><span>Soubory</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Hledat" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>Seznam&#160;souborů</span></a></li>
      <li><a href="globals.html"><span>Symboly&#160;v&#160;souborech</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Funkce</a> &#124;
<a href="#var-members">Proměnné</a>  </div>
  <div class="headertitle">
<div class="title">Dokumentace souboru cblink.c</div>  </div>
</div><!--header-->
<div class="contents">

<p>Zdrojový kód v čistém C.  
<a href="#details">...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="io_8h_source.html">io.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Funkce</h2></td></tr>
<tr class="memitem:ae7ee340978f5c25f52f0cad1457c6616"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cblink_8c.html#ae7ee340978f5c25f52f0cad1457c6616">Reset_Handler</a> (void)</td></tr>
<tr class="memdesc:ae7ee340978f5c25f52f0cad1457c6616"><td class="mdescLeft">&#160;</td><td class="mdescRight">Místo main() přímo tt. funkce.  <a href="#ae7ee340978f5c25f52f0cad1457c6616">...</a><br /></td></tr>
<tr class="separator:ae7ee340978f5c25f52f0cad1457c6616"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8bd35a29e54743f7d1137d9538d49c7e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cblink_8c.html#a8bd35a29e54743f7d1137d9538d49c7e">pinGpioCoutInit</a> (const unsigned int pin)</td></tr>
<tr class="separator:a8bd35a29e54743f7d1137d9538d49c7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb5d61637c6c9b783750bc7db57b85cb"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cblink_8c.html#aeb5d61637c6c9b783750bc7db57b85cb">pinGpioCtoggle</a> (const unsigned int pin)</td></tr>
<tr class="separator:aeb5d61637c6c9b783750bc7db57b85cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6231aea9bee02a216b4c61648111455"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cblink_8c.html#ad6231aea9bee02a216b4c61648111455">Delay</a> (volatile unsigned int tick)</td></tr>
<tr class="separator:ad6231aea9bee02a216b4c61648111455"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Proměnné</h2></td></tr>
<tr class="memitem:a7d6bf7c18b942048bd98d9f71add52e7"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="io_8h.html#aeaf963814711b481c13b679e41ebf0da">RCC_TypeDef</a> *const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cblink_8c.html#a7d6bf7c18b942048bd98d9f71add52e7">RCC</a> = (<a class="el" href="io_8h.html#aeaf963814711b481c13b679e41ebf0da">RCC_TypeDef</a> *) <a class="el" href="io_8h.html#a0e681b03f364532055d88f63fec0d99d">RCC_BASE</a></td></tr>
<tr class="separator:a7d6bf7c18b942048bd98d9f71add52e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2ab8a1781192d1e591f11ee86ce7b23"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae2ab8a1781192d1e591f11ee86ce7b23"></a>
static <a class="el" href="io_8h.html#a8357f79827b0cf723e3f06fa9c6e3078">GPIO_TypeDef</a> *const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cblink_8c.html#ae2ab8a1781192d1e591f11ee86ce7b23">GPIOX</a> = (<a class="el" href="io_8h.html#a8357f79827b0cf723e3f06fa9c6e3078">GPIO_TypeDef</a> *) <a class="el" href="io_8h.html#ae28050d4824c5875ad860b77a859f5fc">LEDPORT_BASE</a></td></tr>
<tr class="memdesc:ae2ab8a1781192d1e591f11ee86ce7b23"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stejně pro GPIO bránu. <br /></td></tr>
<tr class="separator:ae2ab8a1781192d1e591f11ee86ce7b23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac11906f78c6d5f436938112d88ed7b63"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac11906f78c6d5f436938112d88ed7b63"></a>
const unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cblink_8c.html#ac11906f78c6d5f436938112d88ed7b63">LED</a> = <a class="el" href="io_8h.html#a2b3671e090b0831bfba7d12cfcf2d481">LEDPIN</a></td></tr>
<tr class="memdesc:ac11906f78c6d5f436938112d88ed7b63"><td class="mdescLeft">&#160;</td><td class="mdescRight">Modrá LED na kitu. <br /></td></tr>
<tr class="separator:ac11906f78c6d5f436938112d88ed7b63"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailní popis</h2>
<div class="textblock"><p>Zdrojový kód v čistém C. </p>
<h1><a class="anchor" id="codec"></a>
Celkový kód v C nebo C++.</h1>
<p>Nic na tom není. Vektory jsou v extra souboru <a class="el" href="vectors_8c.html" title="Vektory. ">vectors.c</a>, je to společná část pro C i C++. Jsou použity jen první dva - nastavení SP a reset. </p><div class="fragment"><div class="line"></div><div class="line"><span class="keyword">typedef</span> void (*<a class="code" href="sysvect_8c.html#a6ab3bcca73c395c272467bf51a5fe406">pHandler</a>)   (void);</div><div class="line"></div><div class="line"><span class="keyword">extern</span>  <span class="keywordtype">void</span> <a class="code" href="sysvect_8c.html#a79423d770d2448518d4e62d5d80a115d">_estack</a>       (<span class="keywordtype">void</span>);</div><div class="line"><span class="keyword">extern</span>  <span class="keywordtype">void</span> <a class="code" href="bblink_8cpp.html#ae7ee340978f5c25f52f0cad1457c6616">Reset_Handler</a> (<span class="keywordtype">void</span>);</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * S tímto zápisem se setkáme u složitějších projektů psaných pro GCC.</span></div><div class="line"><span class="comment"> * ALIAS v podstatě znamená, že pokud je vektor např. HardFault_Handler někde dále</span></div><div class="line"><span class="comment"> * v programu definován, použije se právě tato definice. Pokud definován není,</span></div><div class="line"><span class="comment"> * použije se pro obsluhu právě ta ALIAS funkce, která definována být musí.</span></div><div class="line"><span class="comment"> * Jiné překladače to budou mít udělané podobně, ne však úplně stejně. Někdy je</span></div><div class="line"><span class="comment"> * (zřejmě ze zvyku, jiný důvod pro to není) tato část psána v jazyce symbolických adres.</span></div><div class="line"><span class="comment"> * */</span></div><div class="line"><span class="preprocessor">#define ALIAS(f) __attribute__ ((weak, alias (#f)))</span></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="sysvect_8c.html#ab59d772a8941752b9b490ae98e728b0e">NMI_Handler</a>                    (<span class="keywordtype">void</span>) <a class="code" href="sysvect_8c.html#a0bcadbfb9fcd175b07b4d0463e54397f">ALIAS</a>(<a class="code" href="sysvect_8c.html#a4e0c522c1bb26af24accaf20e6b87d12">Default_Handler</a>);</div><div class="line"><span class="keywordtype">void</span> HardFault_Handler              (<span class="keywordtype">void</span>) <a class="code" href="sysvect_8c.html#a0bcadbfb9fcd175b07b4d0463e54397f">ALIAS</a>(Default_Handler);</div><div class="line"><span class="keywordtype">void</span> SVC_Handler                    (<span class="keywordtype">void</span>) <a class="code" href="sysvect_8c.html#a0bcadbfb9fcd175b07b4d0463e54397f">ALIAS</a>(Default_Handler);</div><div class="line"><span class="keywordtype">void</span> PendSV_Handler                 (<span class="keywordtype">void</span>) <a class="code" href="sysvect_8c.html#a0bcadbfb9fcd175b07b4d0463e54397f">ALIAS</a>(Default_Handler);</div><div class="line"><span class="keywordtype">void</span> <a class="code" href="sblink_8c.html#ab5e09814056d617c521549e542639b7e">SysTick_Handler</a>                (<span class="keywordtype">void</span>) <a class="code" href="sysvect_8c.html#a0bcadbfb9fcd175b07b4d0463e54397f">ALIAS</a>(Default_Handler);</div><div class="line"><a class="code" href="sysvect_8c.html#a6ab3bcca73c395c272467bf51a5fe406">pHandler</a> const Vectors[] = {</div><div class="line">  <a class="code" href="sysvect_8c.html#a79423d770d2448518d4e62d5d80a115d">_estack</a>,</div><div class="line">  <a class="code" href="bblink_8cpp.html#ae7ee340978f5c25f52f0cad1457c6616">Reset_Handler</a>,                    <span class="comment">// Reset handler</span></div><div class="line"><span class="preprocessor">#if 0</span></div><div class="line">  <span class="comment">/*  ostatní nepotřebujeme */</span></div><div class="line">  <a class="code" href="sysvect_8c.html#ab59d772a8941752b9b490ae98e728b0e">NMI_Handler</a>,                      <span class="comment">// The NMI handler</span></div><div class="line">  HardFault_Handler,                <span class="comment">// The hard fault handler</span></div><div class="line">  0,                                <span class="comment">// Reserved</span></div><div class="line">  0,                                <span class="comment">// Reserved</span></div><div class="line">  0,                                <span class="comment">// Reserved</span></div><div class="line">  0,                                <span class="comment">// Reserved</span></div><div class="line">  0,                                <span class="comment">// Reserved</span></div><div class="line">  0,                                <span class="comment">// Reserved</span></div><div class="line">  0,                                <span class="comment">// Reserved</span></div><div class="line">  SVC_Handler,                      <span class="comment">// SVCall handler</span></div><div class="line">  0,                                <span class="comment">// Reserved</span></div><div class="line">  0,                                <span class="comment">// Reserved</span></div><div class="line">  PendSV_Handler,                   <span class="comment">// The PendSV handler</span></div><div class="line">  <a class="code" href="sblink_8c.html#ab5e09814056d617c521549e542639b7e">SysTick_Handler</a>                   <span class="comment">// The SysTick handler</span></div><div class="line">  <span class="comment">// ... atd.</span></div><div class="line"><span class="preprocessor">#endif // 0</span></div><div class="line">};</div><div class="line"><span class="keywordtype">void</span> <a class="code" href="sysvect_8c.html#a4e0c522c1bb26af24accaf20e6b87d12">Default_Handler</a> (<span class="keywordtype">void</span>) {</div><div class="line">  <span class="keywordflow">for</span> (;;);</div><div class="line">}</div></div><!-- fragment --><p> Vlastní zdroj pro čisté C (<a class="el" href="cblink_8c.html" title="Zdrojový kód v čistém C. ">cblink.c</a>) </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="io_8h.html">io.h</a>&quot;</span></div><div class="line"><span class="comment">/* Konstanty RCC, GPIOX (ve složitějších případech mohou být i další) jsou ukazatelé</span></div><div class="line"><span class="comment"> * na pevné místo do paměti, kde se nalézají příslušné registry. Protože tyto buňky</span></div><div class="line"><span class="comment"> * paměti jsou deklarovány jako volatilní (__IO), zápis nebo čtení se provádí vždy,</span></div><div class="line"><span class="comment"> * bez ohledu na optimalizaci. Je to ustálený způsob přístupu k registrům procesorů</span></div><div class="line"><span class="comment"> * v jazyce C, C++. Oproti běžným zvyklostem z 8-bitových procesorů je to něco trochu</span></div><div class="line"><span class="comment"> * odlišného, ale je to jen formalizmus, jednoduchý a možná i efektivnější.</span></div><div class="line"><span class="comment"> * Za povšimnutí stojí, že registry jsou 32. i 16.bitové, překladač si s tím poradí.</span></div><div class="line"><span class="comment"> * */</span></div><div class="line"><span class="keyword">static</span> <a class="code" href="structRCC__Type.html">RCC_TypeDef</a>  * <span class="keyword">const</span> <a class="code" href="bblink_8cpp.html#ad31270cbf85d329ff3919782c2b7954a">RCC</a>   = (<a class="code" href="structRCC__Type.html">RCC_TypeDef</a>  *) <a class="code" href="io_8h.html#a0e681b03f364532055d88f63fec0d99d">RCC_BASE</a>;</div><div class="line"><span class="keyword">static</span> <a class="code" href="structGPIO__Type.html">GPIO_TypeDef</a> * <span class="keyword">const</span> <a class="code" href="bblink_8cpp.html#acb0d4fa44090c764873af43555acebc0">GPIOX</a> = (<a class="code" href="structGPIO__Type.html">GPIO_TypeDef</a> *) <a class="code" href="io_8h.html#ae28050d4824c5875ad860b77a859f5fc">LEDPORT_BASE</a>;</div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="bblink_8cpp.html#ae7ee340978f5c25f52f0cad1457c6616">Reset_Handler</a> (<span class="keywordtype">void</span>);</div><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="cblink_8c.html#a8bd35a29e54743f7d1137d9538d49c7e">pinGpioCoutInit</a> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pin) {</div><div class="line">  <span class="comment">// mělo by být nastavení pomocí |=, ale zde jen = nevadí, kratší o 2 instr.</span></div><div class="line">  RCC  -&gt;<a class="code" href="structRCC__Type.html#a649c8df83d94cccb7a070c2392fe0c25">AHBENR</a> = <a class="code" href="io_8h.html#aeafc82bc7e33ca504fac1ffe1ca87195">LEDCLK_GPIOEN</a>;       <span class="comment">// zavést hodiny</span></div><div class="line">  GPIOX-&gt;<a class="code" href="structGPIO__Type.html#a1e4ff7ca2e618e255c9079e524444fa9">MODER</a>  = (1U &lt;&lt; 2*pin);       <span class="comment">// a nastavit jako výstup</span></div><div class="line">}</div><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="cblink_8c.html#aeb5d61637c6c9b783750bc7db57b85cb">pinGpioCtoggle</a> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pin) {</div><div class="line">  GPIOX-&gt;<a class="code" href="structGPIO__Type.html#a8c5244271002166c95b07d6e3f3e1c73">ODR</a>   ^= (1U &lt;&lt; pin);         <span class="comment">// změnit výstup</span></div><div class="line">}</div><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="bblink_8cpp.html#ad6231aea9bee02a216b4c61648111455">Delay</a> (<span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tick) {</div><div class="line">  <span class="keywordflow">while</span> (tick--);</div><div class="line">}</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="cblink_8c.html#ac11906f78c6d5f436938112d88ed7b63">LED</a> = <a class="code" href="io_8h.html#a2b3671e090b0831bfba7d12cfcf2d481">LEDPIN</a>;</div><div class="line"><span class="comment">/*NAKED*/</span> <span class="keywordtype">void</span> <a class="code" href="bblink_8cpp.html#ae7ee340978f5c25f52f0cad1457c6616">Reset_Handler</a> (<span class="keywordtype">void</span>) {</div><div class="line">  <span class="comment">// fillram ();</span></div><div class="line">  <a class="code" href="cblink_8c.html#a8bd35a29e54743f7d1137d9538d49c7e">pinGpioCoutInit</a> (LED);</div><div class="line">  <span class="keywordflow">for</span> (;;) {</div><div class="line">    <a class="code" href="cblink_8c.html#aeb5d61637c6c9b783750bc7db57b85cb">pinGpioCtoggle</a> (LED);</div><div class="line">    <a class="code" href="bblink_8cpp.html#ad6231aea9bee02a216b4c61648111455">Delay</a> (<a class="code" href="io_8h.html#a898f8c58e7f9295dcd48d081926f82ca">DELAY_TIME</a>);</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> Nebo pro C++ (<a class="el" href="bblink_8cpp.html" title="Zdrojový kód v C++. ">bblink.cpp</a>) </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="io_8h.html">io.h</a>&quot;</span></div><div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> { <span class="comment">// Tato část je vždy v čistém C - propojujeme kód v C a C++</span></div><div class="line">  <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="bblink_8cpp.html#ae7ee340978f5c25f52f0cad1457c6616">Reset_Handler</a> (<span class="keywordtype">void</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/* Základní IO použité v programu. Je to podobné jako v čistém C, jen je použita</span></div><div class="line"><span class="comment"> * jiná syntaxe, typická pro C++. Je to stejně potenciálně nebezpečný kus kódu,</span></div><div class="line"><span class="comment"> * tato syntaxe jen umožňuje ji lépe vyhledávat ve zdrojácích. Pokud takové přetypování</span></div><div class="line"><span class="comment"> * napíšeme, dáváme tím najevo, že víme přesně co děláme a byl by problém udělat to jinak.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> <a class="code" href="structRCC__Type.html">RCC_Type</a>  * <span class="keyword">const</span> RCC   = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="structRCC__Type.html">RCC_Type</a>  * const<span class="keyword">&gt;</span> <a class="code" href="io_8h.html#a0e681b03f364532055d88f63fec0d99d">RCC_BASE</a>;</div><div class="line"><span class="keyword">static</span> <a class="code" href="structGPIO__Type.html">GPIO_Type</a> * <span class="keyword">const</span> GPIOX = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="structGPIO__Type.html">GPIO_Type</a> * const<span class="keyword">&gt;</span> <a class="code" href="io_8h.html#ae28050d4824c5875ad860b77a859f5fc">LEDPORT_BASE</a>;</div><div class="line"></div><div class="line"><span class="comment">/* I když to napíšeme jako třídu v C++, nic se nezmění.</span></div><div class="line"><span class="comment"> *  Po optimalizaci kód nijak nenaroste. Dá se dokonce říct,</span></div><div class="line"><span class="comment"> *  (alespoň u mé verze GCC to tak je), že děláme úplně stejnou</span></div><div class="line"><span class="comment"> *  věc a výsledná binárka je tedy úplně stejná jako v případě</span></div><div class="line"><span class="comment"> *  C-kódu. Protože jsou všechny metody jednoduché můžeme je nechat</span></div><div class="line"><span class="comment"> *  přímo v deklaraci třídy (deklarace je zároveň i definicí), takže</span></div><div class="line"><span class="comment"> *  budou implicitně inline - stejně jako v C.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">class </span><a class="code" href="classGPIOCC.html">GPIOCC</a> {</div><div class="line">  <span class="keyword">public</span>:</div><div class="line">    <a class="code" href="classGPIOCC.html#a47cb6007e0d5aa15fcadc277d2384a27">GPIOCC</a> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> pin) : bitpos (1U &lt;&lt; pin) {</div><div class="line">      <span class="comment">// mělo by být nastavení pomocí |=, ale zde jen = nevadí, kratší o 2 instr.</span></div><div class="line">      RCC  -&gt;<a class="code" href="structRCC__Type.html#a649c8df83d94cccb7a070c2392fe0c25">AHBENR</a> = <a class="code" href="io_8h.html#aeafc82bc7e33ca504fac1ffe1ca87195">LEDCLK_GPIOEN</a>;       <span class="comment">// zavést hodiny</span></div><div class="line">      GPIOX-&gt;<a class="code" href="structGPIO__Type.html#a1e4ff7ca2e618e255c9079e524444fa9">MODER</a>  = (1U &lt;&lt; 2*pin);       <span class="comment">// a nastavit jako výstup</span></div><div class="line">    }</div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="classGPIOCC.html#a98af72407d0a1906f12be2b796f96139">toggle</a> (<span class="keywordtype">void</span>)<span class="keyword"> const </span>{</div><div class="line">      GPIOX-&gt;<a class="code" href="structGPIO__Type.html#a8c5244271002166c95b07d6e3f3e1c73">ODR</a> ^= bitpos;                <span class="comment">// změnit výstup</span></div><div class="line">    }</div><div class="line">    <span class="keywordtype">void</span> <span class="keyword">set</span> (<span class="keyword">const</span> <span class="keywordtype">bool</span> state = <span class="keyword">true</span>) <span class="keyword">const</span> {          <span class="comment">// nepoužito</span></div><div class="line">      <span class="keywordflow">if</span> (state) GPIOX-&gt;<a class="code" href="structGPIO__Type.html#ac8abb78ad8c9451ffe7c87c167b495c3">BSRRL</a> = bitpos;</div><div class="line">      <span class="keywordflow">else</span>       GPIOX-&gt;<a class="code" href="structGPIO__Type.html#ab274911cbdae36f9c3fee8b8113ff94b">BSRRH</a> = bitpos;</div><div class="line">    }</div><div class="line">  <span class="keyword">private</span>:</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> bitpos;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="bblink_8cpp.html#ad6231aea9bee02a216b4c61648111455">Delay</a> (<span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tick) {</div><div class="line">  <span class="keywordflow">while</span> (tick--);</div><div class="line">}</div><div class="line"><span class="comment">// main() není potřeba, voláme přímo toto</span></div><div class="line"><span class="comment">/*NAKED*/</span> <span class="keywordtype">void</span> <a class="code" href="bblink_8cpp.html#ae7ee340978f5c25f52f0cad1457c6616">Reset_Handler</a> (<span class="keywordtype">void</span>) {</div><div class="line">  <span class="comment">/* Instance GPIOCC je v tomto případě vytvořena na zásobníku z těchto důvodů :</span></div><div class="line"><span class="comment">   * 1. při vyšší optimalizaci se data třídy stejně nepoužijí,</span></div><div class="line"><span class="comment">   * 2. pokud by byla třída statická, bylo by nutné řešit volání statického konstruktoru,</span></div><div class="line"><span class="comment">   * což není triviální a zbytečně by to komplikovalo tento jednoduchý příklad.</span></div><div class="line"><span class="comment">   * (3. možností je vytvořit objekt na haldě, ale to je zcela mimo toto pojednání.)</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <a class="code" href="classGPIOCC.html">GPIOCC</a> led (<a class="code" href="io_8h.html#a2b3671e090b0831bfba7d12cfcf2d481">LEDPIN</a>);</div><div class="line">  <span class="keywordflow">for</span> (;;) {</div><div class="line">    led.toggle ();</div><div class="line">    <a class="code" href="bblink_8cpp.html#ad6231aea9bee02a216b4c61648111455">Delay</a> (<a class="code" href="io_8h.html#a898f8c58e7f9295dcd48d081926f82ca">DELAY_TIME</a>);</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> a potřebná hlavička </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stddef.h&gt;</span></div><div class="line"><span class="preprocessor">#ifndef _IO_H</span></div><div class="line"><span class="preprocessor">#define _IO_H</span></div><div class="line"><span class="preprocessor">#define __IO volatile</span></div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef ARM_CM0</span></div><div class="line"><span class="comment">// Vyzobano z STM stm32f0xx.h</span></div><div class="line"><span class="comment"></span><span class="keyword">struct </span><a class="code" href="structRCC__Type.html">RCC_Type</a> {</div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#a79294251588bee89d7c5404a49d5b4ac">CR</a>;         </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#a8424fbf9730dbad68f8b44d2b59f5361">CFGR</a>;       </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#a2e06bfa71c9039f46d8bd672ae8fa108">CIR</a>;        </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#a8e400d6b14b7564ddc3bfa559f4f84da">APB2RSTR</a>;   </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#a703460a9346a3ae189650852052d0fc0">APB1RSTR</a>;   </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#a649c8df83d94cccb7a070c2392fe0c25">AHBENR</a>;     </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#addce15bda7760628c4ce315c5cc1d3b1">APB2ENR</a>;    </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#a4ebfbec666e5fe565a559a59f8da7fae">APB1ENR</a>;    </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#ad23f3a8b785b56b8ed3b267fef55eb90">BDCR</a>;       </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#a040570e270b99da0eac95b3cf508f10e">CSR</a>;        </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#a910ab5a58a68287d7456e242b591d022">AHBRSTR</a>;    </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#aba83acf3be029ca0810ed156ef184cf8">CFGR2</a>;      </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#a0048ab75f4f1397d291cd1b6193eba2b">CFGR3</a>;      </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#a63b9270219624bb6591c9fe89de9d567">CR2</a>;        </div><div class="line">} ;</div><div class="line"><span class="keyword">struct </span><a class="code" href="structGPIO__Type.html">GPIO_Type</a> {</div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t MODER;        </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint16_t OTYPER;       </div><div class="line">  uint16_t RESERVED0;         </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t OSPEEDR;      </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t PUPDR;        </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint16_t IDR;          </div><div class="line">  uint16_t RESERVED1;         </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint16_t ODR;          </div><div class="line">  uint16_t RESERVED2;         </div><div class="line">  <span class="keyword">union </span>{                     <span class="comment">// Kompatibilita s F4 zavede trochu chaos, ale funkční - původně jeden 32.bit registr</span></div><div class="line">    <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t BSRR;         </div><div class="line">    <span class="keyword">struct </span>{                  <span class="comment">// Jde takto rozdělit (jako v F4) na dva 16. bitové registry</span></div><div class="line">      <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint16_t BSRRL;      </div><div class="line">      <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint16_t BSRRH;      </div><div class="line">    };</div><div class="line">  };</div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t LCKR;         </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t AFR[2];       </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint16_t BRR;          </div><div class="line">  uint16_t RESERVED3;         </div><div class="line">} ;</div><div class="line"></div><div class="line"><span class="preprocessor">#define     PERIPH_BASE       ((uint32_t)    0x40000000)     </span></div><div class="line"><span class="preprocessor">#define  AHBPERIPH_BASE       (PERIPH_BASE + 0x00020000)     </span></div><div class="line"><span class="preprocessor">#define AHB2PERIPH_BASE       (PERIPH_BASE + 0x08000000)     </span></div><div class="line"><span class="preprocessor">#define        RCC_BASE       (AHBPERIPH_BASE  + 0x00001000) </span></div><div class="line"><span class="preprocessor">#define      GPIOC_BASE       (AHB2PERIPH_BASE + 0x00000800) </span></div><div class="line"><span class="preprocessor">#define  RCC_AHBENR_GPIOCEN   ((uint32_t)0x00080000)         </span></div><div class="line"><span class="preprocessor">// board specific</span></div><div class="line"><span class="preprocessor">#define LEDPORT_BASE  GPIOC_BASE                             </span></div><div class="line"><span class="preprocessor">#define LEDCLK_GPIOEN RCC_AHBENR_GPIOCEN                     </span></div><div class="line"><span class="preprocessor">#define LEDPIN        8                                      </span></div><div class="line"><span class="preprocessor">#define DELAY_TIME    0x40000                                </span></div><div class="line"><span class="preprocessor">#define DELAY_SYST    4000000                               </span></div><div class="line"><span class="preprocessor">typedef enum {</span></div><div class="line">  <span class="comment">/******  Cortex-M0 Processor Exceptions Numbers **************************************************************/</span></div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8ade177d9c70c89e084093024b932a4e30">NonMaskableInt_IRQn</a>         = -14,    </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8ab1a222a34a32f0ef5ac65e714efc1f85">HardFault_IRQn</a>              = -13,    </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a59050edea936c20ef456024c900e71f9">SVC_IRQn</a>                    = -5,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a03c3cc89984928816d81793fc7bce4a2">PendSV_IRQn</a>                 = -2,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a6dbff8f8543325f3474cbae2446776e7">SysTick_IRQn</a>                = -1,     </div><div class="line">  <span class="comment">/******  STM32F051x4/STM32F051x6/STM32F051x8 specific Interrupt Numbers **************************************/</span></div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a971089d7566ef902dfa0c80ac3a8fd52">WWDG_IRQn</a>                   = 0,      </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8ab0b51ffcc4dcf5661141b79c8e5bd924">PVD_IRQn</a>                    = 1,      </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8adcc0f2770f7f57f75fac3d8bcac0e858">RTC_IRQn</a>                    = 2,      </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a91b73963ce243a1d031576d49e137fab">FLASH_IRQn</a>                  = 3,      </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a5710b22392997bac63daa5c999730f77">RCC_IRQn</a>                    = 4,      </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8aa192e935e6b7fc8089fc612477bf3a79">EXTI0_1_IRQn</a>                = 5,      </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a78602dc46ee54b2c1f3e6f0ef8f59e5f">EXTI2_3_IRQn</a>                = 6,      </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8aec19518b6dd2358a8b78c2aa29e5d462">EXTI4_15_IRQn</a>               = 7,      </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8afdbb36a3cd235dc3dbf379e5ba53ced6">TSC_IRQn</a>                    = 8,      </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a3ccf41a34f494246c67d3239afa9c97f">DMA1_Channel1_IRQn</a>          = 9,      </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8aa9d5577443e46249121f0d7e2ad50e71">DMA1_Channel2_3_IRQn</a>        = 10,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8ac482c79ad1cc214f715cb3fcbf0ba09c">DMA1_Channel4_5_IRQn</a>        = 11,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a1f21d9fac09be01d78b835759e21d012">ADC1_COMP_IRQn</a>              = 12,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a82ac24e8e4e0df100fe48bc65524dbf5">TIM1_BRK_UP_TRG_COM_IRQn</a>    = 13,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8af312f0a21f600f9b286427e50c549ca9">TIM1_CC_IRQn</a>                = 14,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a3a4e2095a926e4095d3c846eb1c98afa">TIM2_IRQn</a>                   = 15,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a985574288f66e2a00e97387424a9a2d8">TIM3_IRQn</a>                   = 16,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a5f581e9aedfaccd9b1db9ec793804b45">TIM6_DAC_IRQn</a>               = 17,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8ad1f8257995120fd90b0d4c177a02de5f">TIM14_IRQn</a>                  = 19,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a26432264ae205fe79a9f9255f961bc84">TIM15_IRQn</a>                  = 20,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8affb53ebc9ffb3bdec7cb44ab642d32cb">TIM16_IRQn</a>                  = 21,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a35a4ce7d826d3458485265d1dea2b50d">TIM17_IRQn</a>                  = 22,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8af651b1769e03e4653b1a4a7c88132398">I2C1_IRQn</a>                   = 23,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a0e9ff46d0a6311ca3cc43a71702d638d">I2C2_IRQn</a>                   = 24,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8aacdff1a9c42582ed663214cbe62c1174">SPI1_IRQn</a>                   = 25,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a505fbd4ccf7c2a14c8b76dc9e58f7ede">SPI2_IRQn</a>                   = 26,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8ad97cb163e1f678367e37c50d54d161ab">USART1_IRQn</a>                 = 27,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a3f9c48714d0e5baaba6613343f0da68e">USART2_IRQn</a>                 = 28,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a78610c5d7048ef077aaf3341c7106f12">CEC_CAN_IRQn</a>                = 30      </div><div class="line">} <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8">IRQn_Type</a>;</div><div class="line"></div><div class="line"><span class="preprocessor">#define __CM0_REV                 0 </span></div><div class="line"><span class="preprocessor">#define __MPU_PRESENT             0 </span></div><div class="line"><span class="preprocessor">#define __NVIC_PRIO_BITS          2 </span></div><div class="line"><span class="preprocessor">#define __Vendor_SysTickConfig    0 </span></div><div class="line"><span class="preprocessor">#include &quot;core_cm0.h&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#endif // ARM_CM0</span></div><div class="line"><span class="preprocessor">#ifdef ARM_CM4</span></div><div class="line"></div><div class="line"><span class="comment">// Vyzobano z STM stm32f4xx.h</span></div><div class="line"><span class="comment">// RCC</span></div><div class="line"><span class="keyword">struct </span><a class="code" href="structRCC__Type.html">RCC_Type</a> {</div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#a79294251588bee89d7c5404a49d5b4ac">CR</a>;            </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t PLLCFGR;       </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#a8424fbf9730dbad68f8b44d2b59f5361">CFGR</a>;          </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#a2e06bfa71c9039f46d8bd672ae8fa108">CIR</a>;           </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t AHB1RSTR;      </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t AHB2RSTR;      </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t AHB3RSTR;      </div><div class="line">  uint32_t      RESERVED0;     </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#a703460a9346a3ae189650852052d0fc0">APB1RSTR</a>;      </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#a8e400d6b14b7564ddc3bfa559f4f84da">APB2RSTR</a>;      </div><div class="line">  uint32_t      RESERVED1[2];  </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#a649c8df83d94cccb7a070c2392fe0c25">AHBENR</a>;        </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t AHB2ENR;       </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t AHB3ENR;       </div><div class="line">  uint32_t      RESERVED2;     </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#a4ebfbec666e5fe565a559a59f8da7fae">APB1ENR</a>;       </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#addce15bda7760628c4ce315c5cc1d3b1">APB2ENR</a>;       </div><div class="line">  uint32_t      RESERVED3[2];  </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t AHB1LPENR;     </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t AHB2LPENR;     </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t AHB3LPENR;     </div><div class="line">  uint32_t      RESERVED4;     </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t APB1LPENR;     </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t APB2LPENR;     </div><div class="line">  uint32_t      RESERVED5[2];  </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#ad23f3a8b785b56b8ed3b267fef55eb90">BDCR</a>;          </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t <a class="code" href="structRCC__Type.html#a040570e270b99da0eac95b3cf508f10e">CSR</a>;           </div><div class="line">  uint32_t      RESERVED6[2];  </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t SSCGR;         </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t PLLI2SCFGR;    </div><div class="line">} ;</div><div class="line"><span class="comment">// GPIO</span></div><div class="line"><span class="keyword">struct </span><a class="code" href="structGPIO__Type.html">GPIO_Type</a> {</div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t MODER;    </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t OTYPER;   </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t OSPEEDR;  </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t PUPDR;    </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t IDR;      </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t ODR;      </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint16_t BSRRL;    </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint16_t BSRRH;    </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t LCKR;     </div><div class="line">  <a class="code" href="io_8h.html#aec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t AFR[2];   </div><div class="line">} ;</div><div class="line"></div><div class="line"><span class="preprocessor">#define PERIPH_BASE           ((uint32_t)0x40000000)</span></div><div class="line"><span class="preprocessor">#define AHB1PERIPH_BASE       (PERIPH_BASE + 0x00020000)</span></div><div class="line"><span class="preprocessor">#define RCC_BASE              (AHB1PERIPH_BASE + 0x3800)</span></div><div class="line"><span class="preprocessor">#define GPIOD_BASE            (AHB1PERIPH_BASE + 0x0C00)</span></div><div class="line"><span class="comment">// board specific</span></div><div class="line"><span class="preprocessor">#define LEDPORT_BASE  GPIOD_BASE</span></div><div class="line"><span class="preprocessor">#define LEDPIN        15</span></div><div class="line"><span class="preprocessor">#define LEDCLK_GPIOEN ((uint32_t)0x00000008)</span></div><div class="line"><span class="preprocessor">#define DELAY_TIME    0x200000</span></div><div class="line"><span class="preprocessor">#define DELAY_SYST    8000000                       </span></div><div class="line"><span class="preprocessor">typedef enum IRQn {</span></div><div class="line">  <span class="comment">/******  Cortex-M4 Processor Exceptions Numbers ****************************************************************/</span></div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8ade177d9c70c89e084093024b932a4e30">NonMaskableInt_IRQn</a>         = -14,    </div><div class="line">  MemoryManagement_IRQn       = -12,    </div><div class="line">  BusFault_IRQn               = -11,    </div><div class="line">  UsageFault_IRQn             = -10,    </div><div class="line">  SVCall_IRQn                 = -5,     </div><div class="line">  DebugMonitor_IRQn           = -4,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a03c3cc89984928816d81793fc7bce4a2">PendSV_IRQn</a>                 = -2,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a6dbff8f8543325f3474cbae2446776e7">SysTick_IRQn</a>                = -1,     </div><div class="line">  <span class="comment">/******  STM32 specific Interrupt Numbers **********************************************************************/</span></div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a971089d7566ef902dfa0c80ac3a8fd52">WWDG_IRQn</a>                   = 0,      </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8ab0b51ffcc4dcf5661141b79c8e5bd924">PVD_IRQn</a>                    = 1,      </div><div class="line">  TAMP_STAMP_IRQn             = 2,      </div><div class="line">  RTC_WKUP_IRQn               = 3,      </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a91b73963ce243a1d031576d49e137fab">FLASH_IRQn</a>                  = 4,      </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a5710b22392997bac63daa5c999730f77">RCC_IRQn</a>                    = 5,      </div><div class="line">  EXTI0_IRQn                  = 6,      </div><div class="line">  EXTI1_IRQn                  = 7,      </div><div class="line">  EXTI2_IRQn                  = 8,      </div><div class="line">  EXTI3_IRQn                  = 9,      </div><div class="line">  EXTI4_IRQn                  = 10,     </div><div class="line">  DMA1_Stream0_IRQn           = 11,     </div><div class="line">  DMA1_Stream1_IRQn           = 12,     </div><div class="line">  DMA1_Stream2_IRQn           = 13,     </div><div class="line">  DMA1_Stream3_IRQn           = 14,     </div><div class="line">  DMA1_Stream4_IRQn           = 15,     </div><div class="line">  DMA1_Stream5_IRQn           = 16,     </div><div class="line">  DMA1_Stream6_IRQn           = 17,     </div><div class="line">  ADC_IRQn                    = 18,     </div><div class="line">  CAN1_TX_IRQn                = 19,     </div><div class="line">  CAN1_RX0_IRQn               = 20,     </div><div class="line">  CAN1_RX1_IRQn               = 21,     </div><div class="line">  CAN1_SCE_IRQn               = 22,     </div><div class="line">  EXTI9_5_IRQn                = 23,     </div><div class="line">  TIM1_BRK_TIM9_IRQn          = 24,     </div><div class="line">  TIM1_UP_TIM10_IRQn          = 25,     </div><div class="line">  TIM1_TRG_COM_TIM11_IRQn     = 26,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8af312f0a21f600f9b286427e50c549ca9">TIM1_CC_IRQn</a>                = 27,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a3a4e2095a926e4095d3c846eb1c98afa">TIM2_IRQn</a>                   = 28,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a985574288f66e2a00e97387424a9a2d8">TIM3_IRQn</a>                   = 29,     </div><div class="line">  TIM4_IRQn                   = 30,     </div><div class="line">  I2C1_EV_IRQn                = 31,     </div><div class="line">  I2C1_ER_IRQn                = 32,     </div><div class="line">  I2C2_EV_IRQn                = 33,     </div><div class="line">  I2C2_ER_IRQn                = 34,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8aacdff1a9c42582ed663214cbe62c1174">SPI1_IRQn</a>                   = 35,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a505fbd4ccf7c2a14c8b76dc9e58f7ede">SPI2_IRQn</a>                   = 36,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8ad97cb163e1f678367e37c50d54d161ab">USART1_IRQn</a>                 = 37,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a3f9c48714d0e5baaba6613343f0da68e">USART2_IRQn</a>                 = 38,     </div><div class="line">  USART3_IRQn                 = 39,     </div><div class="line">  EXTI15_10_IRQn              = 40,     </div><div class="line">  RTC_Alarm_IRQn              = 41,     </div><div class="line">  OTG_FS_WKUP_IRQn            = 42,     </div><div class="line">  TIM8_BRK_TIM12_IRQn         = 43,     </div><div class="line">  TIM8_UP_TIM13_IRQn          = 44,     </div><div class="line">  TIM8_TRG_COM_TIM14_IRQn     = 45,     </div><div class="line">  TIM8_CC_IRQn                = 46,     </div><div class="line">  DMA1_Stream7_IRQn           = 47,     </div><div class="line">  FSMC_IRQn                   = 48,     </div><div class="line">  SDIO_IRQn                   = 49,     </div><div class="line">  TIM5_IRQn                   = 50,     </div><div class="line">  SPI3_IRQn                   = 51,     </div><div class="line">  UART4_IRQn                  = 52,     </div><div class="line">  UART5_IRQn                  = 53,     </div><div class="line">  <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8a5f581e9aedfaccd9b1db9ec793804b45">TIM6_DAC_IRQn</a>               = 54,     </div><div class="line">  TIM7_IRQn                   = 55,     </div><div class="line">  DMA2_Stream0_IRQn           = 56,     </div><div class="line">  DMA2_Stream1_IRQn           = 57,     </div><div class="line">  DMA2_Stream2_IRQn           = 58,     </div><div class="line">  DMA2_Stream3_IRQn           = 59,     </div><div class="line">  DMA2_Stream4_IRQn           = 60,     </div><div class="line">  ETH_IRQn                    = 61,     </div><div class="line">  ETH_WKUP_IRQn               = 62,     </div><div class="line">  CAN2_TX_IRQn                = 63,     </div><div class="line">  CAN2_RX0_IRQn               = 64,     </div><div class="line">  CAN2_RX1_IRQn               = 65,     </div><div class="line">  CAN2_SCE_IRQn               = 66,     </div><div class="line">  OTG_FS_IRQn                 = 67,     </div><div class="line">  DMA2_Stream5_IRQn           = 68,     </div><div class="line">  DMA2_Stream6_IRQn           = 69,     </div><div class="line">  DMA2_Stream7_IRQn           = 70,     </div><div class="line">  USART6_IRQn                 = 71,     </div><div class="line">  I2C3_EV_IRQn                = 72,     </div><div class="line">  I2C3_ER_IRQn                = 73,     </div><div class="line">  OTG_HS_EP1_OUT_IRQn         = 74,     </div><div class="line">  OTG_HS_EP1_IN_IRQn          = 75,     </div><div class="line">  OTG_HS_WKUP_IRQn            = 76,     </div><div class="line">  OTG_HS_IRQn                 = 77,     </div><div class="line">  DCMI_IRQn                   = 78,     </div><div class="line">  CRYP_IRQn                   = 79,     </div><div class="line">  HASH_RNG_IRQn               = 80,      </div><div class="line">  FPU_IRQn                    = 81      </div><div class="line">} <a class="code" href="io_8h.html#a7e1129cd8a196f4284d41db3e82ad5c8">IRQn_Type</a>;</div><div class="line"></div><div class="line"><span class="preprocessor">#define __CM4_REV                 0x0001  </span></div><div class="line"><span class="preprocessor">#define __MPU_PRESENT             1       </span></div><div class="line"><span class="preprocessor">#define __NVIC_PRIO_BITS          4       </span></div><div class="line"><span class="preprocessor">#define __Vendor_SysTickConfig    0       </span></div><div class="line"><span class="preprocessor">#include &quot;core_cm4.h&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#endif // ARM_CM4</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structRCC__Type.html">RCC_Type</a>  <a class="code" href="structRCC__Type.html">RCC_TypeDef</a>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structGPIO__Type.html">GPIO_Type</a> <a class="code" href="structGPIO__Type.html">GPIO_TypeDef</a>;</div><div class="line"><span class="comment">// Funkce obsluhující vektor reset je bez návratu, nemusí tedy nic uklízet na zásobník.</span></div><div class="line"><span class="comment">// Proto ji můžeme definovat jako naked, pro případné zkrácení kódu. Není to však nutné (alespoň pro gcc).</span></div><div class="line"><span class="comment"></span><span class="preprocessor">#define NAKED __attribute__((naked))</span></div><div class="line"></div><div class="line"><span class="comment">// Naplň část ram definovaným obsahem - debug stacku.</span></div><div class="line"><span class="comment"></span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="io_8h.html#aaa675fd04a75e62f160ec05173350e02">fillram</a> (<span class="keywordtype">void</span>) {</div><div class="line">  __ASM <span class="keyword">volatile</span> (</div><div class="line">    <span class="stringliteral">&quot;ldr  r0, =0x20000800\n\t&quot;</span>  <span class="comment">// od</span></div><div class="line">    <span class="stringliteral">&quot;ldr  r1, =0x20001800\n\t&quot;</span>  <span class="comment">// do</span></div><div class="line">    <span class="stringliteral">&quot;ldr  r2, =0xDEADBEEF\n&quot;</span>    <span class="comment">// obsah</span></div><div class="line">    <span class="stringliteral">&quot;floop:\n\t&quot;</span></div><div class="line">    <span class="stringliteral">&quot;str  r2, [r0, #0]\n\t&quot;</span></div><div class="line">    <span class="stringliteral">&quot;add  r0, r0,  #4\n\t&quot;</span></div><div class="line">    <span class="stringliteral">&quot;cmp  r0, r1\n\t&quot;</span></div><div class="line">    <span class="stringliteral">&quot;bne  floop\n\t&quot;</span></div><div class="line"><span class="comment">//  &quot;bkpt 0\n&quot;</span></div><div class="line">    );</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#endif// _IO_H</span></div></div><!-- fragment --><h1><a class="anchor" id="codes"></a>
Celkový kód v Assembleru.</h1>
<p>Všimněte si, že popis instrukční sady (thumb, code 16) i typu procesoru je zabudován přímo do zdrojového textu. </p><div class="fragment"><div class="line">.ifdef ARM_CM0</div><div class="line">        .cpu cortex-m0</div><div class="line">        .fpu softvfp</div><div class="line">        .set RCCREG,   0x40021000</div><div class="line">        .set RCCSET,   20</div><div class="line">        .set RCCENB,   19</div><div class="line">        .set GPIOREG,  0x48000800</div><div class="line">        .set LED,      8</div><div class="line">        .set DLED,     16</div><div class="line">        .set DROFS,    20</div><div class="line">        .set TIME,     18</div><div class="line">.endif</div><div class="line">.ifdef ARM_CM4</div><div class="line">        .cpu cortex-m4</div><div class="line">        .fpu softvfp</div><div class="line">        .set RCCREG,   0x40023800</div><div class="line">        .set RCCSET,   48</div><div class="line">        .set RCCENB,   3</div><div class="line">        .set GPIOREG,  0x40020C00</div><div class="line">        .set LED,      15</div><div class="line">        .set DLED,     30</div><div class="line">        .set DROFS,    20</div><div class="line">        .set TIME,     18</div><div class="line">.endif</div><div class="line">        .section        .text.Reset_Handler,&quot;ax&quot;,%progbits</div><div class="line">        .align  1</div><div class="line">        .global Reset_Handler</div><div class="line">        .code   16</div><div class="line">        .thumb_func</div><div class="line">        .type   Reset_Handler, %function</div><div class="line">Reset_Handler:</div><div class="line">        mov     r2, #1                  @ obecna jednicka, zachovava se cely cas behu</div><div class="line"></div><div class="line">        ldr     r3, RCC                 @ hodiny</div><div class="line">        lsl     r0, r2,  #RCCENB</div><div class="line">        str     r0, [r3, #RCCSET]</div><div class="line"></div><div class="line">        ldr     r3, GPIOC               @ pin jako vystup</div><div class="line">        lsl     r0, r2,  #DLED</div><div class="line">        str     r0, [r3]</div><div class="line"></div><div class="line">        lsl     r1, r2,  #LED           @ r1 = pozice LED</div><div class="line">InfiniteLoop:</div><div class="line">        ldrh    r0, [r3, #DROFS]        @ xor vystupu</div><div class="line">        eor     r0, r1</div><div class="line">        strh    r0, [r3, #DROFS]</div><div class="line"></div><div class="line">@       ldr     r0, Dly                 @ zpozdeni - setrime tedy -&gt;</div><div class="line">        lsl     r0, r2,  #TIME          @ alternativne takto, pokud staci nasobky 2</div><div class="line">DelayLoop:</div><div class="line">        sub     r0, r2</div><div class="line">        cmp     r0, #0</div><div class="line">        bne     DelayLoop</div><div class="line">        b       InfiniteLoop</div><div class="line"></div><div class="line">        .align  2</div><div class="line">RCC:    .word   RCCREG</div><div class="line">GPIOC:  .word   GPIOREG</div><div class="line">@Dly:   .word   0x00040000</div><div class="line"></div><div class="line">/* Tohle je obsah vectors.c přeložený do jazyka symbolických adres. */</div><div class="line">        .global Vectors</div><div class="line">        .extern _estack</div><div class="line">        .section        .rodata.Vectors,&quot;a&quot;,%progbits</div><div class="line">        .align  2</div><div class="line">        .type   Vectors, %object</div><div class="line">Vectors:</div><div class="line">        .word   _estack</div><div class="line">        .word   Reset_Handler</div><div class="line">/* Použijeme to tak v jednom souboru aby bylo vidět, že i to jde    */</div></div><!-- fragment --><h1><a class="anchor" id="codet"></a>
C-čkový kód pro blikání pomocí systémového časovače.</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="io_8h.html">io.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="dbgmcu_8h.html">dbgmcu.h</a>&quot;</span></div><div class="line"><span class="keyword">extern</span> uint32_t <a class="code" href="sblink_8c.html#a995c883852645633f6eb8a38979ebe98">_vect_tab</a>; </div><div class="line"></div><div class="line"><span class="keyword">static</span> <a class="code" href="structRCC__Type.html">RCC_TypeDef</a>  * <span class="keyword">const</span> RCC   = (<a class="code" href="structRCC__Type.html">RCC_TypeDef</a>  *) <a class="code" href="io_8h.html#a0e681b03f364532055d88f63fec0d99d">RCC_BASE</a>;</div><div class="line"><span class="keyword">static</span> <a class="code" href="structGPIO__Type.html">GPIO_TypeDef</a> * <span class="keyword">const</span> GPIOX = (<a class="code" href="structGPIO__Type.html">GPIO_TypeDef</a> *) <a class="code" href="io_8h.html#ae28050d4824c5875ad860b77a859f5fc">LEDPORT_BASE</a>;</div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="bblink_8cpp.html#ae7ee340978f5c25f52f0cad1457c6616">Reset_Handler</a> (<span class="keywordtype">void</span>);</div><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="cblink_8c.html#a8bd35a29e54743f7d1137d9538d49c7e">pinGpioCoutInit</a> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pin) {</div><div class="line">  RCC  -&gt;<a class="code" href="structRCC__Type.html#a649c8df83d94cccb7a070c2392fe0c25">AHBENR</a> |= <a class="code" href="io_8h.html#aeafc82bc7e33ca504fac1ffe1ca87195">LEDCLK_GPIOEN</a>;       <span class="comment">// zavést hodiny</span></div><div class="line">  GPIOX-&gt;<a class="code" href="structGPIO__Type.html#a1e4ff7ca2e618e255c9079e524444fa9">MODER</a>  |= (1U &lt;&lt; 2*pin);       <span class="comment">// a nastavit jako výstup</span></div><div class="line">}</div><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="cblink_8c.html#aeb5d61637c6c9b783750bc7db57b85cb">pinGpioCtoggle</a>  (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pin) {</div><div class="line">  GPIOX-&gt;<a class="code" href="structGPIO__Type.html#a8c5244271002166c95b07d6e3f3e1c73">ODR</a>    ^= (1U &lt;&lt; pin);          <span class="comment">// změnit výstup</span></div><div class="line">}</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> LED = <a class="code" href="io_8h.html#a2b3671e090b0831bfba7d12cfcf2d481">LEDPIN</a>;</div><div class="line"><span class="comment">//  Obsluha přerušení od systémového časovače SysTick</span></div><div class="line"><span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="sblink_8c.html#ab5e09814056d617c521549e542639b7e">SysTick_Handler</a> (<span class="keywordtype">void</span>) {</div><div class="line">  <a class="code" href="cblink_8c.html#aeb5d61637c6c9b783750bc7db57b85cb">pinGpioCtoggle</a> (LED);                 <span class="comment">// Jen změní stav LED, blikáme tedy s frekvencí 1 Hz</span></div><div class="line">}</div><div class="line"><span class="comment">/*NAKED*/</span> <span class="keywordtype">void</span> <a class="code" href="bblink_8cpp.html#ae7ee340978f5c25f52f0cad1457c6616">Reset_Handler</a> (<span class="keywordtype">void</span>) {</div><div class="line">  <span class="comment">// fillram();</span></div><div class="line"><span class="preprocessor">#ifdef ARM_CM4</span></div><div class="line">  <a class="code" href="dbgmcu_8h.html#a1756eb148e235eeb4fc0bceb1ad7e106">EnableDebugOnSleep</a> ();                <span class="comment">// Pokud použiji na F4 wfi, pak je dobré povolit debug v tt. módu</span></div><div class="line">  SCB-&gt;VTOR = (uint32_t) &amp;_vect_tab;    <span class="comment">// Možná zbytečné, ale funkční - umístění vektorů pro F4</span></div><div class="line"><span class="preprocessor">#endif // ARM_CM4</span></div><div class="line">  SysTick_Config  (<a class="code" href="io_8h.html#a7dd9dcdcffac36b44b79f0dff38559dd">DELAY_SYST</a>);</div><div class="line">  <a class="code" href="cblink_8c.html#a8bd35a29e54743f7d1137d9538d49c7e">pinGpioCoutInit</a> (LED);</div><div class="line">  <span class="keywordflow">for</span> (;;) {    <span class="comment">// Pro zmenšení spotřeby můžeme uP uspat,</span></div><div class="line">    __WFI ();   <span class="comment">// probudí se při přerušení od SysTick.</span></div><div class="line">  }</div><div class="line">}</div><div class="line"></div></div><!-- fragment --><h1><a class="anchor" id="make"></a>
Makefile.</h1>
<p>Výsledek je vytvořen pomocí Makefile. Vypadá to složitě, ale je to poměrně univerzální kopyto, jež lze použít i pro dost složité projekty. Proto je tam i dost komentářů, z kterých (snad) lze pochopit, jak to funguje. </p><div class="fragment"><div class="line">##########################################################################</div><div class="line"># Uživatelské definice - pro dané nastavení zde lze vytvořit projekt</div><div class="line"># jednoduše tak, že zadáme jméno výstupu a vstupní objekty.</div><div class="line">##########################################################################</div><div class="line"># Pro STM32F0 Discovery</div><div class="line"># CPU_TYPE = cortex-m0</div><div class="line"># Pro STM32F4 Discovery</div><div class="line">CPU_TYPE = cortex-m4</div><div class="line"></div><div class="line"></div><div class="line"># VPATH je cesta ke zdrojovým souborům, zde jen hlavní adresář</div><div class="line">VPATH = .</div><div class="line"># C files</div><div class="line">COBJS  = vectors.o cblink.o</div><div class="line"># C/C++ files</div><div class="line">BOBJS  = vectors.o bblink.o</div><div class="line"># ASM files</div><div class="line">AOBJS  = ablink.o</div><div class="line"></div><div class="line">SOBJS  = sysvect.o sblink.o</div><div class="line">##########################################################################</div><div class="line"># Následují pokročilejší nastavení - cesta k hlavičkám</div><div class="line">##########################################################################</div><div class="line">INCLUDE_PATHS  = -I.</div><div class="line">##########################################################################</div><div class="line"># GNU GCC OR clang compiler - verze pro ARM - crosscompiler</div><div class="line">##########################################################################</div><div class="line">CROSS_COMPILE = arm-none-eabi-</div><div class="line"># Můžeme zkusit použít i clang - pak COMPILER = clang</div><div class="line">COMPILER = </div><div class="line">ifeq ($(COMPILER),clang)</div><div class="line"># Pro clang je lépe nastavit vyšší optimalizaci, -fshort-enums je kvůli kompatibititě s ld.</div><div class="line"># Ta verze clang-3.5 jako příkaz je z Ubuntu - pozor různé verze mají odlišné přepínače cílové architektury (-target)</div><div class="line">CC  = clang-3.8   -target arm -mfloat-abi=soft -fshort-enums -O3</div><div class="line">CXX = clang++-3.8 -target arm -mfloat-abi=soft -fshort-enums -O3</div><div class="line">else</div><div class="line">CC  = $(CROSS_COMPILE)gcc -Os</div><div class="line">CXX = $(CROSS_COMPILE)g++ -Os</div><div class="line">endif</div><div class="line"></div><div class="line"># Assembler (*.s) lze překládat i pomocí gcc (-x assembler-with-cpp)</div><div class="line">AS   = $(CROSS_COMPILE)as</div><div class="line"># Stejně tak linkování se obvykle provádí pomocí gcc, zde pro názornost přímo</div><div class="line">LD   = $(CROSS_COMPILE)ld</div><div class="line">SIZE = $(CROSS_COMPILE)size</div><div class="line">OBJCOPY = $(CROSS_COMPILE)objcopy</div><div class="line">OBJDUMP = $(CROSS_COMPILE)objdump</div><div class="line"></div><div class="line">##########################################################################</div><div class="line"># Startup files - zde jen skript pro linker</div><div class="line">##########################################################################</div><div class="line">LD_SCRIPT = script.ld</div><div class="line">##########################################################################</div><div class="line"># Nastavení parametrů překladu</div><div class="line">##########################################################################</div><div class="line"># 1.Překlad pomocí gcc / g++</div><div class="line">ifeq ($(CPU_TYPE),cortex-m0)</div><div class="line">DEFINES = ARM_CM0</div><div class="line">endif</div><div class="line">ifeq ($(CPU_TYPE),cortex-m4)</div><div class="line">DEFINES = ARM_CM4</div><div class="line">endif</div><div class="line"># Defines - podmineny preklad</div><div class="line">CFLAGS  = -D$(DEFINES) -I./cmsis</div><div class="line"># Instrukční sada thumb, cpu Cortex-Mx</div><div class="line">MFLAGS = -mthumb -mcpu=$(CPU_TYPE)</div><div class="line">ifneq ($(COMPILER),clang)</div><div class="line"># Vytvořit listing s příponou .lst (divné, ale - kouzlit se dá všelijak)</div><div class="line"># clang tento přepínač neakceptuje, protože funguje trochu jinak</div><div class="line">CFLAGS += -Wa,-adhlns=$(@:%.o=%.lst)</div><div class="line">endif</div><div class="line">CFLAGS += $(MFLAGS)</div><div class="line"># Cesta k hlavičkám, optimalizace na velikost, všechna varování, debug info</div><div class="line">CFLAGS += -c $(INCLUDE_PATHS) -Wall -g</div><div class="line"># Umístit kód funkcí i proměnné do vzláštních sekcí</div><div class="line">CFLAGS += -ffunction-sections -fdata-sections</div><div class="line"># pro C++ nutno ještě vypnout obsluhu výjimek</div><div class="line">CFLAGS += -fno-exceptions</div><div class="line"># 2. Linker</div><div class="line"># Vytvořit mapu rozvržení paměti, křížové reference</div><div class="line">LDFLAGS = --cref</div><div class="line"># bez default startupu (crt.o), odstranit nepotřebné sekce</div><div class="line">LDFLAGS+= -nostartfiles</div><div class="line">LDFLAGS+= --gc-sections</div><div class="line"># Vlastní linker skript</div><div class="line">LDLIBS  = -T $(LD_SCRIPT)</div><div class="line"># 3. Ostatní</div><div class="line"># Assembler nepotřebuje žádné parametry, pokud je vše ve zdrojovém textu</div><div class="line">ASFLAGS = --defsym $(DEFINES)=1</div><div class="line"># Odřež na výstupu vše nepotřebné (objcopy)</div><div class="line">OCFLAGS = --strip-unneeded</div><div class="line"></div><div class="line">##########################################################################</div><div class="line"># Rules - pravidla pro tvorbu výstupu.</div><div class="line">##########################################################################</div><div class="line"></div><div class="line"># Výsledek všeho (all) má být soubor *.elf - z něj se odvodí další</div><div class="line">all: cblinking.elf bblinking.elf ablinking.elf sblinking.elf</div><div class="line"># Ten je závislý na objektech $(XOBJS) : po jeho vytvoření lze udělat hex, bin atd...</div><div class="line">cblinking.elf: $(COBJS)</div><div class="line">        $(LD) -Map=cblinking.map $(LDFLAGS) -o cblinking.elf $(COBJS) $(LDLIBS)</div><div class="line">        -@echo &quot;&quot;</div><div class="line">        $(SIZE) cblinking.elf</div><div class="line">        -@echo &quot;&quot;</div><div class="line">        $(OBJCOPY) $(OCFLAGS) -O binary cblinking.elf cblinking.bin</div><div class="line">        $(OBJCOPY) $(OCFLAGS) -O ihex   cblinking.elf cblinking.hex</div><div class="line">        $(OBJDUMP) -h -S cblinking.elf &gt; cblinking.lst</div><div class="line">        -@echo &quot;&quot;</div><div class="line"># stejne C++</div><div class="line">bblinking.elf: $(BOBJS)</div><div class="line">        $(LD) -Map=bblinking.map $(LDFLAGS) -o bblinking.elf $(BOBJS) $(LDLIBS)</div><div class="line">        -@echo &quot;&quot;</div><div class="line">        $(SIZE) bblinking.elf</div><div class="line">        -@echo &quot;&quot;</div><div class="line">        $(OBJCOPY) $(OCFLAGS) -O binary bblinking.elf bblinking.bin</div><div class="line">        $(OBJCOPY) $(OCFLAGS) -O ihex   bblinking.elf bblinking.hex</div><div class="line">        $(OBJDUMP) -h -S bblinking.elf &gt; bblinking.lst</div><div class="line">        -@echo &quot;&quot;</div><div class="line"># stejne ASM</div><div class="line">ablinking.elf: $(AOBJS)</div><div class="line">        $(LD) -Map=ablinking.map $(LDFLAGS) -o ablinking.elf $(AOBJS) $(LDLIBS)</div><div class="line">        -@echo &quot;&quot;</div><div class="line">        $(SIZE) ablinking.elf</div><div class="line">        -@echo &quot;&quot;</div><div class="line">        $(OBJCOPY) $(OCFLAGS) -O binary ablinking.elf ablinking.bin</div><div class="line">        $(OBJCOPY) $(OCFLAGS) -O ihex   ablinking.elf ablinking.hex</div><div class="line">        $(OBJDUMP) -h -S ablinking.elf &gt; ablinking.lst</div><div class="line">        -@echo &quot;&quot;</div><div class="line"># blikani pomoci systick</div><div class="line">sblinking.elf: $(SOBJS)</div><div class="line">        $(LD) -Map=sblinking.map $(LDFLAGS) -o sblinking.elf $(SOBJS) $(LDLIBS)</div><div class="line">        -@echo &quot;&quot;</div><div class="line">        $(SIZE) sblinking.elf</div><div class="line">        -@echo &quot;&quot;</div><div class="line">        $(OBJCOPY) $(OCFLAGS) -O binary sblinking.elf sblinking.bin</div><div class="line">        $(OBJCOPY) $(OCFLAGS) -O ihex   sblinking.elf sblinking.hex</div><div class="line">        $(OBJDUMP) -h -S sblinking.elf &gt; sblinking.lst</div><div class="line">        -@echo &quot;&quot;</div><div class="line"># Divná makra $@ $&lt; lze najít v dokumentaci make</div><div class="line"># Každý objekt *.o je závislý na zdroji - zde *.c</div><div class="line">%.o : %.c</div><div class="line">        $(CC) -std=c11 $(CFLAGS) -o $@ $&lt;</div><div class="line"># nebo c++</div><div class="line">%.o : %.cpp</div><div class="line">        $(CXX) $(CFLAGS) -o $@ $&lt;</div><div class="line"># nebo *.s</div><div class="line">%.o : %.s</div><div class="line">        $(AS) $(ASFLAGS) -o $@ $&lt;</div><div class="line"></div><div class="line"># Vyčištění adresáře</div><div class="line">clean:</div><div class="line">        rm -f *.o *.map *~ *.lst *.elf *.hex *.bin</div></div><!-- fragment --><h1><a class="anchor" id="link"></a>
Linker skript.</h1>
<div class="fragment"><div class="line">/* Entry Point - musí být definován     */</div><div class="line">ENTRY(Vectors)</div><div class="line"></div><div class="line">/* Specifikace paměťových prostorů čipu */</div><div class="line">MEMORY {</div><div class="line">  RAM (xrw)       : ORIGIN = 0x20000000, LENGTH = 4K</div><div class="line">  ROM (xr)        : ORIGIN = 0x08000000, LENGTH = 4K</div><div class="line">}</div><div class="line">/* Kam umístíme stack - navrch RAM */</div><div class="line">_estack = ORIGIN(RAM) + LENGTH(RAM);</div><div class="line">/* Definice výstupních sekcí       */</div><div class="line">SECTIONS {</div><div class="line">  .fixed : {</div><div class="line">    /* Takto se vkládají symboly, které se pak mohou použít jako konstanty v programu.</div><div class="line">    Tečka představuje aktuální hodnotu PC (jako v asm), tedy adresu symbolu. */</div><div class="line">    _vect_tab = .;</div><div class="line">    /* Obvykle se tato sekce nějak pojmenuje, zde víme, že gcc to pojmenuje</div><div class="line">       právě takto, není pak třeba používat __attribute__((section(&quot;nazev&quot;))).</div><div class="line">       Linker by to mohl uklidit (gc-sections), ale ENTRY (Vectors) to zachová</div><div class="line">       takže není potřeba používat KEEP. Tohle jsou ale už dost divné finty */</div><div class="line">    *(.rodata.Vectors)</div><div class="line">    *(.text*)            /* .text*   sections (code)                              */</div><div class="line">    *(.rodata*)          /* .rodata* sections (constants, strings, etc.)          */</div><div class="line">    *(.eh_frame)</div><div class="line">  } &gt;RAM</div><div class="line">  .reloc : {</div><div class="line">    *(.data*)            /* .data* sections */</div><div class="line">    *(.bss*)             /* .bss*  sections */</div><div class="line">    *(COMMON)</div><div class="line">  } &gt;RAM</div><div class="line"></div><div class="line">  .ARM.attributes 0 : { *(.ARM.attributes) }</div><div class="line">}</div></div><!-- fragment --> </div><h2 class="groupheader">Dokumentace funkcí</h2>
<a class="anchor" id="ad6231aea9bee02a216b4c61648111455"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void Delay </td>
          <td>(</td>
          <td class="paramtype">volatile unsigned int&#160;</td>
          <td class="paramname"><em>tick</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Zpoždění - poněkud špatně definované, ale stačí </p><dl class="params"><dt>Parametry</dt><dd>
  <table class="params">
    <tr><td class="paramname">tick</td><td>- počet průchodů (délka průchodu je právě ne příliš dobře definována) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a8bd35a29e54743f7d1137d9538d49c7e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void pinGpioCoutInit </td>
          <td>(</td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>pin</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Inicializace pinu na portu C jako výstupu </p><dl class="params"><dt>Parametry</dt><dd>
  <table class="params">
    <tr><td class="paramname">pin</td><td>Pin na portu C </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="aeb5d61637c6c9b783750bc7db57b85cb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void pinGpioCtoggle </td>
          <td>(</td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>pin</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Manipulace s výstupem - změna log. hodnoty na pinu. </p><dl class="params"><dt>Parametry</dt><dd>
  <table class="params">
    <tr><td class="paramname">pin</td><td>Pin na portu C </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ae7ee340978f5c25f52f0cad1457c6616"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Reset_Handler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Místo main() přímo tt. funkce. </p>
<p>Obsluha vektoru Reset.</p>
<p>main() není potřeba </p>

</div>
</div>
<h2 class="groupheader">Dokumentace proměnných</h2>
<a class="anchor" id="a7d6bf7c18b942048bd98d9f71add52e7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="io_8h.html#aeaf963814711b481c13b679e41ebf0da">RCC_TypeDef</a>* const RCC = (<a class="el" href="io_8h.html#aeaf963814711b481c13b679e41ebf0da">RCC_TypeDef</a> *) <a class="el" href="io_8h.html#a0e681b03f364532055d88f63fec0d99d">RCC_BASE</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Základní IO použité v programu. Nejsou DEFINE, const je čitší, při optimalizaci stejně místo v paměti nezaberou. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generováno st 27. zář 2017 08.34:12 pro projekt ARM_minimal. programem &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
